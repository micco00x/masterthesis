\chapter{Experiments}
\label{ch:experiments}

To test the behaviour of the whole project, multiple experiments have been 
performed. In particular, different scenario and test cases have been designed 
in order to study in detail the functionalities of the robot and each program.
As previously introduced, the humanoid robot used for the experiments of this 
thesis is NAO \cite{NAOdesign}, which has been equipped with an ASUS Xtion 
Pro RGB-D camera \cite{ASUSXtionProWebsite}, placed on top of its head.
As mentioned in the first chapter, the camera communicates with
\texttt{elevation\_mapping} (Chapter \ref{ch:elevation-map-generation}),
which creates a representation of the environment
called elevation map, which is used by the footstep planner, described in 
Chapter \ref{ch:rrt-based-footstep-planning}, to generate a safe and feasible 
plan for the robot. The footsteps are sent to the robot, which runs an 
implementation of the Variable Height CoM Intrinsically Stable MPC (Chapter 
\ref{ch:vh-com-is-mpc}) that allows the robot to correctly performe the 
desired motion, making it navigate in a \textit{World 
of Stairs} environment.

The experiments have been performed by initially checking the real capabilities 
of the robot, making it first climb a single staircase and then a stairway 
composed of multiple staircases, in order to better understand 
the kind of scenario that NAO can handle. At this point only the MPC is 
used, assigning the footsteps manually. Then, the footstep planner is 
introduced into the project, making NAO navigate autonomously from its initial 
position to a goal region, given an elevation map of the environment which has 
been manually created. In the end, NAO is equipped with an ASUS Xtion Pro 
camera. This allows to introduce \texttt{elevation\_mapping} to the project,
generating autonomously elevation maps, making NAO able to move in 
a \textit{World of Stairs} environment which is not known a priori,
correctly climbing the stairs in order to reach a desired position.

\section{NAO and Computer Settings}
The NAO v5 humanoid robot (Fig: \ref{fig:nao-with-xtion-2}), developed by 
Softbank, is 57 cm tall and weights 5.4 kg. It is equipped with an Intel ATOM 
Z530 processor which has a frequencly of 1.6 Ghz, 1 GB of RAM and 2 GB of 
flash storage. It has 25 DoF, 7 touch sensors located on the head, the hands 
and the feet, two internal cameras, 4 microphones, a speaker, sonar and IMU 
sensors. The framework used for the experiments, which has been installed on 
the robot, is BHuman \cite{BHumanCodeRelease2018}, which simplifies the 
development of on board algorithms by organizing the framework in modules.
When using the full settings, NAO is equipped with an ASUS Xtion Pro RGB-D
camera,
which is connected to an external computer via a USB cable. This external 
computer communicates with NAO via an ethernet cable through TCP.
Both \texttt{elevation\_mapping} and the footstep planner run on the external 
computer, which is equipped with an Intel Core i5-5257U with 2.70 GHz
base frequency and 16 GB of RAM. The Variable Height CoM IS-MPC runs on the 
robot. 
\begin{figure}
  \centering
  \includegraphics[width=0.5\textwidth]{figures/NAO-with-xtion-2.JPEG}
  \caption{The figure shows NAO v5 humanoid robot, the platform
      used for the experiments of this thesis, equipped with an ASUS Xtion
      Pro RGB-D camera. The camera is connected via USB to an external 
      computer which runs \texttt{elevation\_mapping} and the footstep 
      planner. The external computer communicates with NAO through an 
      ethernet cable using TCP.}
  \label{fig:nao-with-xtion-2}
\end{figure}


\section{Simple Staircase}
Staircase from 1cm to 5cm. Limitations of the robot.
\begin{figure}
  \centering
  \includegraphics[width=\textwidth]
      {figures/experiments/simple-staircase/xy-plot-4cm.pdf}
  \includegraphics[width=\textwidth]
      {figures/experiments/simple-staircase/xz-plot-4cm.pdf}
  \caption{The plots show how the CoM and the ZMP vary with respect to the
		footsteps in the scenario ``Simple Staircase''.
    The green boxes represent the footsteps.}
  \label{fig:experiments:simple-staircase:comzmp}
\end{figure}

\section{Multiple Staircases}
Two consecutive staircases of 2cm.

\subsection{Upstairs}
Upstairs.
\begin{figure}
  \begin{subfigure}{0.48\textwidth}
    \includegraphics[width=\linewidth]
      {figures/experiments/multiple-staircases/upstairs/video/01.png}
    \caption{Starting position}
    \label{fig:exp:ms:up:frame1}
  \end{subfigure}\hspace*{\fill}
  \begin{subfigure}{0.48\textwidth}
    \includegraphics[width=\linewidth]
      {figures/experiments/multiple-staircases/upstairs/video/02.png}
    \caption{First step}
  \end{subfigure}
  \begin{subfigure}{0.48\textwidth}
    \includegraphics[width=\linewidth]
      {figures/experiments/multiple-staircases/upstairs/video/03.png}
    \caption{Second step}
  \end{subfigure}\hspace*{\fill}
  \begin{subfigure}{0.48\textwidth}
    \includegraphics[width=\linewidth]
      {figures/experiments/multiple-staircases/upstairs/video/04.png}
    \caption{Third step}
  \end{subfigure}
  \begin{subfigure}{0.48\textwidth}
    \includegraphics[width=\linewidth]
      {figures/experiments/multiple-staircases/upstairs/video/05.png}
    \caption{Fourth step}
  \end{subfigure}\hspace*{\fill}
  \begin{subfigure}{0.48\textwidth}
    \includegraphics[width=\linewidth]
      {figures/experiments/multiple-staircases/upstairs/video/06.png}
    \caption{Fifth step}
  \end{subfigure}
  \caption{The figures show the motion of the robot for the scenario
      ``Multiple Staircases (Upstairs)''. The robot starts just in 
      front of the stairs (Fig. \ref{fig:exp:ms:up:frame1}), then it places 
      each step one in front of the other without colliding with the staircases,
      safely climbing the stairway. Each staircase has a height of 2 cm.}
  \label{fig:experiments:multiple-staircases:upstairs:videoframes}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[width=\textwidth]
      {figures/experiments/multiple-staircases/upstairs/xy-plot-2cm.pdf}
  \includegraphics[width=\textwidth]
      {figures/experiments/multiple-staircases/upstairs/xz-plot-2cm.pdf}
  \caption{The plots show how the CoM and the ZMP vary with respect to the
		footsteps in the scenario ``Multiple Staircases (Upstairs)''.
    The green boxes represent the footsteps.}
  \label{fig:experiments:multiple-staircases:upstairs:comzmp}
\end{figure}

\subsection{Downstairs}
Downstairs.
\begin{figure}
  \begin{subfigure}{0.48\textwidth}
    \includegraphics[width=\linewidth]
      {figures/experiments/multiple-staircases/downstairs/video/01.png}
    \caption{Starting position}
    \label{fig:exp:ms:down:frame1}
  \end{subfigure}\hspace*{\fill}
  \begin{subfigure}{0.48\textwidth}
    \includegraphics[width=\linewidth]
      {figures/experiments/multiple-staircases/downstairs/video/02.png}
    \caption{First step}
  \end{subfigure}
  \begin{subfigure}{0.48\textwidth}
    \includegraphics[width=\linewidth]
      {figures/experiments/multiple-staircases/downstairs/video/03.png}
    \caption{Second step}
  \end{subfigure}\hspace*{\fill}
  \begin{subfigure}{0.48\textwidth}
    \includegraphics[width=\linewidth]
      {figures/experiments/multiple-staircases/downstairs/video/04.png}
    \caption{Third step}
  \end{subfigure}
  \begin{subfigure}{0.48\textwidth}
    \includegraphics[width=\linewidth]
      {figures/experiments/multiple-staircases/downstairs/video/05.png}
    \caption{Fourth step}
  \end{subfigure}\hspace*{\fill}
  \begin{subfigure}{0.48\textwidth}
    \includegraphics[width=\linewidth]
      {figures/experiments/multiple-staircases/downstairs/video/06.png}
    \caption{Fifth step}
  \end{subfigure}
  \caption{The figures show the motion of the robot for the scenario
      ``Multiple Staircases (Downstairs)''. The robot starts on top of the 
      stairway (Fig. \ref{fig:exp:ms:down:frame1}), then it places 
      each step one in front of the other without colliding with the staircases,
      safely reaching ground level. Each staircase has a height of 2 cm.}
  \label{fig:experiments:multiple-staircases:downstairs:videoframes}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[width=\textwidth]
      {figures/experiments/multiple-staircases/downstairs/xy-plot-2cm.pdf}
  \includegraphics[width=\textwidth]
      {figures/experiments/multiple-staircases/downstairs/xz-plot-2cm.pdf}
  \caption{The plots show how the CoM and the ZMP vary with respect to the
		footsteps in the scenario ``Multiple Staircases (Downstairs)''.
    The green boxes represent the footsteps.}
  \label{fig:experiments:multiple-staircases:downstairs:comzmp}
\end{figure}

\section{Obstacle Avoidance}
Footstep planning with manually generated elevation mapping. Map contains 
an obstacle that can not be climbed by NAO because of short legs.
\begin{figure}
  \begin{subfigure}{0.48\textwidth}
    \includegraphics[width=\linewidth]
      {figures/experiments/obstacle-avoidance/video/01.png}
    \caption{Starting position}
    \label{fig:exp:obs:frame1}
  \end{subfigure}\hspace*{\fill}
  \begin{subfigure}{0.48\textwidth}
    \includegraphics[width=\linewidth]
      {figures/experiments/obstacle-avoidance/video/02.png}
    \caption{Moving to the left}
    \label{fig:exp:obs:frame2}
  \end{subfigure}
  \begin{subfigure}{0.48\textwidth}
    \includegraphics[width=\linewidth]
      {figures/experiments/obstacle-avoidance/video/03.png}
    \caption{Avoiding the obstacle}
  \end{subfigure}\hspace*{\fill}
  \begin{subfigure}{0.48\textwidth}
    \includegraphics[width=\linewidth]
      {figures/experiments/obstacle-avoidance/video/04.png}
    \caption{Moving forward}
  \end{subfigure}
  \begin{subfigure}{0.48\textwidth}
    \includegraphics[width=\linewidth]
      {figures/experiments/obstacle-avoidance/video/05.png}
    \caption{Moving towards the goal}
    \label{fig:exp:obs:frame5}
  \end{subfigure}\hspace*{\fill}
  \begin{subfigure}{0.48\textwidth}
    \includegraphics[width=\linewidth]
      {figures/experiments/obstacle-avoidance/video/06.png}
    \caption{Goal region reached}
    \label{fig:exp:obs:frame6}
  \end{subfigure}
  \caption{The figures show the motion of the robot for the scenario
      ``Obstacle Avoidance''. The robot starts in front of the obstacle
      (Fig. \ref{fig:exp:obs:frame1}), then it moves to its left correctly
      avoiding it (Fig. \ref{fig:exp:obs:frame2}-\ref{fig:exp:obs:frame5})
      until it reaches the goal region (Fig. \ref{fig:exp:obs:frame6}),
      whose center is represented by 
      the ball. The goal region is a circle with a radius of 10 cm. 
      Note that even if the obstacle has a height of 2 cm, NAO can not climb it 
      because of its kinematic limitations, hence, the planner takes
      into account the mechanical capabilities of the robot, generating a 
      safe and realizable footstep plan.}
  \label{fig:experiments:obstacle-avoidance:videoframes}
\end{figure}

\begin{figure}
    \centering
    \includegraphics[width=0.95\textwidth]
        {figures/experiments/obstacle-avoidance/footstep-plan.pdf}
    \caption{Footstep plan generated for the scenario ``Obstacle Avoidance''.}
    \label{fig:experiments:obstacle-avoidance:footstep-plan}
\end{figure}
\begin{figure}
    \centering
    \includegraphics[width=0.95\textwidth]
        {figures/experiments/obstacle-avoidance/rrt-tree.pdf}
    \caption{Tree generated for the scenario ``Obstacle Avoidance''.}
    \label{fig:experiments:obstacle-avoidance:rrt-tree}
\end{figure}

\section{Stair Climbing in Unknown Environment}
Stair climbing (unknown environment). Planner + \texttt{elevation\_mapping}.
\begin{figure}
  \begin{subfigure}{0.48\textwidth}
    \includegraphics[width=\linewidth]
      {figures/experiments/unknown-env/video/01.png}
    \caption{Starting position}
    \label{fig:exp:unkenv:frame1}
  \end{subfigure}\hspace*{\fill}
  \begin{subfigure}{0.48\textwidth}
    \includegraphics[width=\linewidth]
      {figures/experiments/unknown-env/video/02.png}
    \caption{First step}
    \label{fig:exp:unkenv:frame2}
  \end{subfigure}
  \begin{subfigure}{0.48\textwidth}
    \includegraphics[width=\linewidth]
      {figures/experiments/unknown-env/video/03.png}
    \caption{Second step}
  \end{subfigure}\hspace*{\fill}
  \begin{subfigure}{0.48\textwidth}
    \includegraphics[width=\linewidth]
      {figures/experiments/unknown-env/video/04.png}
    \caption{Third step}
  \end{subfigure}
  \begin{subfigure}{0.48\textwidth}
    \includegraphics[width=\linewidth]
      {figures/experiments/unknown-env/video/05.png}
    \caption{Fourth step}
  \end{subfigure}\hspace*{\fill}
  \begin{subfigure}{0.48\textwidth}
    \includegraphics[width=\linewidth]
      {figures/experiments/unknown-env/video/06.png}
    \caption{Fifth step}
  \end{subfigure}
  \begin{subfigure}{0.48\textwidth}
    \includegraphics[width=\linewidth]
      {figures/experiments/unknown-env/video/07.png}
    \caption{Seventh step}
  \end{subfigure}\hspace*{\fill}
  \begin{subfigure}{0.48\textwidth}
    \includegraphics[width=\linewidth]
      {figures/experiments/unknown-env/video/08.png}
    \caption{Eighth step}
  \end{subfigure} \caption{The figures show the motion of the robot
      for the scenario ``Stair Climbing (Unknown Environment)''.
      The robot starts at 20 cm 
      from the first staircase (Fig. \ref{fig:exp:unkenv:frame1}). Before 
      starting the motion (Fig. \ref{fig:exp:unkenv:frame2}), an
      elevation map is built by the \texttt{elevation\_mapping} framework
      (Chapter \ref{ch:elevation-map-generation}),
      which receives the depth frames from the ASUS Xtion Pro placed 
      on top of the robot. The elevation map is sent to the planner, which 
      generates a footstep plan (Chapter \ref{ch:rrt-based-footstep-planning}).
      The footstep plan is then sent to the 
      robot, which executes the motion by using the Variable Height CoM
      IS-MPC (Chapter \ref{ch:vh-com-is-mpc}). The robot correctly manages to 
      climb the stairs without colliding with the staircases. Each staircase 
      has a height of 2 cm.}
  \label{fig:experiments:unkenv:videoframes}
\end{figure}

\begin{figure}
    \centering
    \includegraphics[width=0.95\textwidth]
        {figures/experiments/unknown-env/footstep-plan.pdf}
    \caption{Footstep plan generated for the scenario ``Stair Climbing in 
        Unknown Environments''.}
    \label{fig:experiments:unknown-env:footstep-plan}
\end{figure}
\begin{figure}
    \centering
    \includegraphics[width=0.95\textwidth]
        {figures/experiments/unknown-env/rrt-tree.pdf}
    \caption{Tree generated for the scenario ``Stair Climbing in 
        Unknown Environments''.}
    \label{fig:experiments:unknown-env:rrt-tree}
\end{figure}

